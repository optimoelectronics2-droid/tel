<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin — Trifusion Technologies</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  padding:20px;
  font-family:system-ui, Arial, sans-serif;
  background:#0b0f19;
  color:#e6ecff;
}
.panel{
  max-width:500px;
  margin:auto;
  background:#101624;
  padding:20px;
  border-radius:12px;
  border:1px solid #1f2940;
}
h2{margin-top:0}
input, button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:none;
}
button{
  font-weight:700;
  cursor:pointer;
}
.producto{
  border:1px solid #1f2940;
  padding:10px;
  border-radius:10px;
  margin-top:10px;
}
.producto img{
  width:100%;
  margin-top:6px;
  border-radius:6px;
}
.acciones{
  display:flex;
  gap:6px;
  margin-top:6px;
}
.acciones button{flex:1}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="panel">
  <h2>Administrador</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Contraseña">
  <button onclick="login()">Entrar</button>
</div>

<!-- ADMIN -->
<div id="adminBox" class="panel" style="display:none">
  <h2>Imágenes de productos</h2>

  <input id="productId" placeholder="ID del producto (ej: hp-15-fd0215dx)">
  <input id="productImage" placeholder="Link público de imagen">
  <button onclick="guardar()">Guardar / Actualizar</button>

  <h3 style="margin-top:20px">Productos guardados</h3>
  <div id="lista"></div>

  <button style="margin-top:20px" onclick="logout()">Salir</button>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
// ================= AUTH =================
function login(){
  auth.signInWithEmailAndPassword(
    email.value,
    password.value
  ).catch(e=>alert(e.message));
}

function logout(){
  auth.signOut();
}

auth.onAuthStateChanged(user=>{
  loginBox.style.display = user ? "none" : "block";
  adminBox.style.display = user ? "block" : "none";
  if(user) cargar();
});

// ================= CRUD =================
function guardar(){
  const id = productId.value.trim();
  const img = productImage.value.trim();
  if(!id) return alert("ID requerido");

  db.collection("products")
    .doc(id)
    .set({ image: img })
    .then(()=>{
      productId.value="";
      productImage.value="";
      cargar();
    });
}

function cargar(){
  lista.innerHTML="";
  db.collection("products").get().then(snap=>{
    snap.forEach(doc=>{
      const d = doc.data();
      const div = document.createElement("div");
      div.className="producto";
      div.innerHTML=`
        <strong>${doc.id}</strong>
        ${d.image ? `<img src="${d.image}">` : ""}
        <div class="acciones">
          <button onclick="editar('${doc.id}','${d.image||""}')">Editar</button>
          <button onclick="borrar('${doc.id}')">Borrar</button>
        </div>
      `;
      lista.appendChild(div);
    });
  });
}

function editar(id,img){
  productId.value = id;
  productImage.value = img;
  window.scrollTo(0,0);
}

function borrar(id){
  if(!confirm("¿Eliminar este producto?")) return;
  db.collection("products").doc(id).delete().then(cargar);
}
</script>

</body>
</html>
