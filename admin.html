<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin — Trifusion Technologies</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:system-ui, Arial;
  background:#0b0f19;
  color:#e6ecff;
  margin:0;
  padding:20px;
}
.panel{
  max-width:420px;
  margin:auto;
  background:#101624;
  padding:20px;
  border-radius:12px;
  border:1px solid #1f2940;
}
input,button{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:none;
}
button{
  font-weight:700;
  cursor:pointer;
}
.producto{
  margin-top:10px;
  border:1px solid #1f2940;
  padding:10px;
  border-radius:8px;
}
img{
  width:100%;
  margin-top:6px;
  border-radius:6px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="panel">
  <h2>Admin Login</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Contraseña">
  <button onclick="login()">Entrar</button>
</div>

<!-- PANEL -->
<div id="admin" class="panel" style="display:none">
  <h2>Agregar / Editar imagen</h2>

  <input id="productName" placeholder="Nombre exacto del producto">
  <input id="productImage" placeholder="Link público de imagen (Drive)">
  <button onclick="guardar()">Guardar</button>

  <h3>Productos con imagen</h3>
  <div id="lista"></div>

  <button style="margin-top:20px" onclick="logout()">Salir</button>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
// ========= HELPERS =========
function idProducto(text){
  return text
    .toLowerCase()
    .replace(/[^a-z0-9]+/g,"-")
    .replace(/(^-|-$)/g,"");
}

// ========= AUTH =========
function login(){
  auth.signInWithEmailAndPassword(
    email.value,
    password.value
  ).catch(e=>alert(e.message));
}

function logout(){
  auth.signOut();
}

auth.onAuthStateChanged(user=>{
  login.style.display = user ? "none" : "block";
  admin.style.display = user ? "block" : "none";
  if(user) cargar();
});

// ========= CRUD =========
function guardar(){
  const name = productName.value.trim();
  const image = productImage.value.trim();
  if(!name) return alert("Nombre requerido");

  db.collection("products")
    .doc(idProducto(name))
    .set({ image })
    .then(()=>{
      productName.value="";
      productImage.value="";
      cargar();
    });
}

function cargar(){
  lista.innerHTML="";
  db.collection("products").get().then(snap=>{
    snap.forEach(doc=>{
      const d = doc.data();
      const div = document.createElement("div");
      div.className="producto";
      div.innerHTML=`
        <strong>${doc.id}</strong>
        ${d.image ? `<img src="${d.image}">` : ""}
        <button onclick="borrar('${doc.id}')">Borrar</button>
      `;
      lista.appendChild(div);
    });
  });
}

function borrar(id){
  if(!confirm("¿Eliminar imagen?")) return;
  db.collection("products").doc(id).delete().then(cargar);
}
</script>

</body>
</html>
