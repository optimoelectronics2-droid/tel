<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Trifusion Technologies â€” CatÃ¡logo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:system-ui, Arial;
  background:#0b0f19;
  color:#e6ecff;
}
header{padding:18px;background:#000}
.catalogo{max-width:1100px;margin:30px auto;padding:0 16px}
.categoria{
  margin:26px 0 14px;
  padding:14px 18px;
  background:rgba(0,194,255,.25);
  border-left:6px solid #00c2ff;
  font-weight:800;
  text-transform:uppercase;
}
.producto{
  background:#101624;
  border:1px solid #1f2940;
  border-radius:12px;
  padding:14px;
  margin-bottom:10px;
  display:flex;
  align-items:center;
  gap:10px;
}
.descripcion{flex:1;color:#00c2ff;font-weight:600}
.precio{color:#ff4b6a;font-weight:700}
.btn-img{
  background:#00c2ff;
  color:#02030a;
  border:none;
  border-radius:6px;
  padding:6px 10px;
  cursor:pointer;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal img{max-width:90%;max-height:90%}
</style>
</head>

<body>

<header>
  <h1>Trifusion Technologies</h1>
</header>

<div id="catalogo" class="catalogo"></div>

<div id="modal" class="modal" onclick="this.style.display='none'">
  <img id="modalImg">
</div>

<!-- LIBS -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
const SHEET_ID = "1EtOwxNRGq0WFgGaRXtJgibUqzxIgcAUeRkJlr1wPsLc";
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;
const cont = document.getElementById("catalogo");

const limpiar = t => t.replace(/[\u{1F300}-\u{1FAFF}]/gu,"").trim();
const idProd = t => limpiar(t).toLowerCase().replace(/[^a-z0-9]+/g,"-");

let imagenes = {};

// cargar imÃ¡genes
db.collection("products").get().then(snap=>{
  snap.forEach(d=>imagenes[d.id]=d.data().image);
});

fetch(CSV_URL)
.then(r=>r.text())
.then(csv=>{
  Papa.parse(csv,{
    skipEmptyLines:true,
    complete:(res)=>{
      res.data.forEach(row=>{
        const A=(row[0]||"").trim();
        const C=(row[2]||"").trim();
        const D=(row[3]||"").trim();

        if(row.filter(c=>(c||"").trim()).length===1){
          const cat=document.createElement("div");
          cat.className="categoria";
          cat.textContent=limpiar(row.join(""));
          cont.appendChild(cat);
          return;
        }

        if(D.toUpperCase().includes("TRANSITO")) return;
        if(!C||!D) return;

        const n=D.replace(/\D/g,"");
        if(!n) return;

        const nombre=limpiar(A?A+" ":"")+C;
        const id=idProd(nombre);
        const img=imagenes[id];

        const p=document.createElement("div");
        p.className="producto";
        p.innerHTML=`
          <div class="descripcion">${nombre}</div>
          ${img?`<button class="btn-img" onclick="verImg('${img}')">ðŸ“·</button>`:""}
          <div class="precio">$${Number(n).toLocaleString("es-DO")}</div>
        `;
        cont.appendChild(p);
      });
    }
  });
});

function verImg(src){
  modalImg.src=src;
  modal.style.display="flex";
}
</script>

</body>
</html>
